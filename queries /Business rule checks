--Payment vs Order Totals

SELECT o.order_id, SUM(oi.price) AS order_total, SUM(p.payment_value) AS payment_total
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
JOIN payments p ON o.order_id = p.order_id
GROUP BY o.order_id
HAVING SUM(oi.price) <> SUM(p.payment_value);



--Shipment Dates Check

SELECT o.order_id, o.order_purchase_timestamp, s.ship_date
FROM orders o
JOIN shipments s ON o.order_id = s.order_id
WHERE s.ship_date < o.order_purchase_timestamp;
